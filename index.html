<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Eggapps Prompt Sihirbazı</title>
  <meta name="description" content="Etkileşimli Chatbot Prompt Sihirbazı. Tek blok prompt, OpenAI messages JSON ve Claude uyumlu çıktı üretimi." />
  <meta name="author" content="Eggapps" />
  <meta property="og:site_name" content="Eggapps" />
  <meta property="og:title" content="Eggapps Prompt Sihirbazı" />
  <meta property="og:description" content="Tarayıcıda prompt oluştur, kopyala/indir. Tek blok, OpenAI JSON, Claude." />

  <!-- Opsiyonel güzel font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- CSS (inline, bu yüzden metin olarak görünmez) -->
  <style>
    :root{
      --bg-1:#0b0f19; --bg-2:#0f172a; --card:#121a2a; --card-2:#121e36;
      --border:rgba(255,255,255,0.08); --muted:#9aa4b2; --text:#e8eef7;
      --primary:#ffd166; --primary-2:#ffe08a; --code:#0a1020; --ok:#40c057;
      --shadow-lg:0 14px 38px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 20% -10%, #10183155, transparent 60%),
                  radial-gradient(900px 500px at 110% 20%, #1b244377, transparent 60%),
                  linear-gradient(180deg, var(--bg-1), var(--bg-2));
      color:var(--text);
      font:16px/1.55 "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .site-header{
      position:sticky; top:0; z-index:20;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 20px;
      background:linear-gradient(180deg, rgba(16,22,38,.8), rgba(16,22,38,.35));
      border-bottom:1px solid var(--border); backdrop-filter:blur(8px);
    }
    .brand{display:flex; align-items:center; gap:10px}
    .logo-emoji{font-size:22px}
    .site-header h1{font-size:18px; margin:0}

    .container{
      max-width:1200px; margin:22px auto; padding:0 16px;
      display:grid; gap:18px; grid-template-columns:1.15fr 1fr;
    }
    @media (max-width:1000px){ .container{ grid-template-columns:1fr } }

    .card{
      background:linear-gradient(180deg, rgba(23,30,50,.9), rgba(18,26,42,.9));
      border:1px solid var(--border); border-radius:16px;
      padding:18px 16px 14px; box-shadow:var(--shadow-lg);
    }
    h1,h2,h3{margin:6px 0 12px} h2{font-size:20px} h3{font-size:16px}

    .form-grid{display:grid; gap:14px}
    .two-col{display:grid; gap:12px; grid-template-columns:1fr 1fr}
    @media (max-width:680px){ .two-col{grid-template-columns:1fr} }

    .field{display:flex; flex-direction:column; gap:6px}
    label{color:var(--muted); font-weight:600}

    input[type="text"], select, textarea{
      border:1px solid var(--border); border-radius:12px; padding:10px 12px;
      background:linear-gradient(180deg, #0f1426, #0e1323); color:var(--text);
      outline:none; transition:border-color .2s, box-shadow .2s, background .2s;
    }
    textarea{resize:vertical; min-height:44px}
    input::placeholder, textarea::placeholder{color:#75819a}
    input:focus, select:focus, textarea:focus{
      border-color:rgba(255,209,102,.6);
      box-shadow:0 0 0 3px rgba(255,209,102,.18);
    }

    .chips{display:flex; flex-wrap:wrap; gap:10px}
    .chips label{
      display:flex; align-items:center; gap:8px;
      background:linear-gradient(180deg, #101633, #0f1429);
      border:1px solid var(--border); padding:8px 12px; border-radius:999px;
      cursor:pointer; user-select:none; color:#dbe6ff;
      transition:transform .12s ease, border-color .2s, background .2s;
    }
    .chips input{appearance:none; width:16px; height:16px; border:1px solid var(--border); border-radius:4px; background:#0f1426}
    .chips input:checked + span{font-weight:700}
    .switch{display:flex; align-items:center; gap:10px; cursor:pointer; color:#dbe6ff}
    .switch input{width:18px; height:18px; accent-color:var(--primary)}

    details.block{
      background:linear-gradient(180deg, #101734, #0f1429);
      border:1px dashed var(--border); border-radius:12px; padding:10px 12px;
    }
    details.block[open]{border-style:solid}
    details.block summary{
      cursor:pointer; font-weight:700; color:var(--primary-2);
      list-style:none; outline:none; margin:2px 0 8px;
    }
    details.block summary::-webkit-details-marker{display:none}

    .actions{display:flex; align-items:center; gap:10px; margin-top:8px; flex-wrap:wrap}
    .btn{
      background:linear-gradient(180deg, var(--primary), #f9c64d);
      color:#1b1b1b; border:none; border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:700;
      box-shadow:0 6px 16px rgba(255,209,102,.25); transition:transform .12s ease, filter .2s, box-shadow .2s;
    }
    .btn:hover{transform:translateY(-1px); filter:brightness(.98)}
    .btn:active{transform:translateY(0) scale(.99)}
    .btn.ghost{background:transparent; color:var(--text); border:1px solid var(--border); box-shadow:none}
    .btn.small{padding:6px 10px; font-size:13px}

    .output-card .output-block{margin-bottom:16px}
    .output-header{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .output-actions{display:flex; align-items:center; gap:8px}

    .code{
      background:linear-gradient(180deg, #0c1224, #0a1020);
      border:1px solid var(--border); border-radius:12px; padding:12px;
      overflow:auto; max-height:420px; color:#d8e6ff; white-space:pre-wrap;
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Cascadia Mono", "Segoe UI Mono", Consolas, "Liberation Mono", monospace;
    }

    .example{border:1px solid var(--border); background:linear-gradient(180deg, #0f152b, #0d1325); border-radius:12px; padding:10px; margin:10px 0}
    .example .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width:680px){ .example .row{grid-template-columns:1fr} }
    .remove-example{color:#ff8787; cursor:pointer; border:none; background:transparent; font-weight:700}

    .site-footer{display:flex; align-items:center; justify-content:center; gap:10px; padding:18px 20px; border-top:1px solid var(--border); color:var(--muted)}
    a{color:var(--primary-2); text-decoration:none} a:hover{text-decoration:underline}
    .muted{color:var(--muted)}
    @media (prefers-reduced-motion:reduce){ *{transition:none !important; animation:none !important} }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <span class="logo-emoji">🥚</span>
      <h1>Eggapps Prompt Sihirbazı</h1>
    </div>
    <div class="header-actions">
      <a class="btn ghost" href="https://github.com/username23487/prompt_wizard" target="_blank" rel="noopener">GitHub</a>
    </div>
  </header>

  <main class="container">
    <section class="card form-card">
      <h2>Form</h2>
      <form id="wizard-form">
        <div class="form-grid">
          <div class="field">
            <label for="title">Başlık (opsiyonel)</label>
            <input id="title" type="text" placeholder="Örn: Ürün gereksinimi sihirbazı" />
          </div>

          <div class="field">
            <label for="objective">Amaç / Görev</label>
            <textarea id="objective" rows="3" placeholder="Bu prompt ne yapsın? (Gerekli)"></textarea>
          </div>

          <div class="field">
            <label for="role_persona">Rol / Persona</label>
            <input id="role_persona" type="text" placeholder="Örn: Deneyimli ürün yöneticisi ve titiz teknik yazar" />
          </div>

          <div class="field">
            <label for="audience">Hedef kitle</label>
            <input id="audience" type="text" placeholder="Örn: Başlangıç seviyesi yazılımcılar" />
          </div>

          <div class="two-col">
            <div class="field">
              <label for="language">Yanıt dili</label>
              <input id="language" type="text" value="Türkçe" />
            </div>
            <div class="field">
              <label for="tone">Ton</label>
              <select id="tone">
                <option>Samimi ama profesyonel</option>
                <option>Resmi</option>
                <option>Nötr</option>
                <option>Öğretici</option>
                <option>Cesaretlendirici</option>
                <option>Mizahi (dozunda)</option>
                <option>Kısa ve net</option>
                <option>Akademik</option>
                <option>Hikâye anlatımı odaklı</option>
              </select>
            </div>
          </div>

          <div class="field">
            <label>Üslup / Biçim</label>
            <div class="chips">
              <label><input type="checkbox" name="style" value="Adım adım" checked><span>Adım adım</span></label>
              <label><input type="checkbox" name="style" value="Madde işaretli" checked><span>Madde işaretli</span></label>
              <label><input type="checkbox" name="style" value="Özet + detay"><span>Özet + detay</span></label>
              <label><input type="checkbox" name="style" value="Kod ağırlıklı"><span>Kod ağırlıklı</span></label>
              <label><input type="checkbox" name="style" value="Tablo kullan"><span>Tablo kullan</span></label>
              <label><input type="checkbox" name="style" value="Soru-cevap"><span>Soru-cevap</span></label>
              <label><input type="checkbox" name="style" value="Örnek odaklı"><span>Örnek odaklı</span></label>
            </div>
          </div>

          <div class="two-col">
            <div class="field">
              <label for="output_format">Çıktı formatı</label>
              <select id="output_format">
                <option>Markdown</option>
                <option>Düz metin</option>
                <option>JSON</option>
              </select>
            </div>
            <div class="field">
              <label for="length_pref">Yaklaşık uzunluk</label>
              <select id="length_pref">
                <option>Orta</option>
                <option>Kısa</option>
                <option>Uzun</option>
              </select>
            </div>
          </div>

          <div class="two-col">
            <label class="switch">
              <input id="ask_clar" type="checkbox" checked />
              <span>Belirsizse önce netleştirici soru sor</span>
            </label>
            <label class="switch">
              <input id="include_reasoning" type="checkbox" />
              <span>Adım adım planla/akıl yürüt</span>
            </label>
          </div>

          <details class="block">
            <summary>Bağlam ve Veri</summary>
            <div class="field">
              <label for="context">Bağlam/Bilgi</label>
              <textarea id="context" rows="3" placeholder="Ek arka plan bilgisi..."></textarea>
            </div>
            <div class="field">
              <label for="input_data">Girdi/Veri</label>
              <textarea id="input_data" rows="3" placeholder="Modelin kullanacağı ham veriler/örnekler..."></textarea>
            </div>
          </details>

          <details class="block">
            <summary>Kısıtlar ve Kaçınılacaklar</summary>
            <div class="two-col">
              <div class="field">
                <label for="constraints">Kısıtlar/Kurallar (satır satır)</label>
                <textarea id="constraints" rows="4" placeholder="Örn: Jargon kullanma&#10;Cevap 500 kelimeyi geçmesin"></textarea>
              </div>
              <div class="field">
                <label for="do_not_list">Yapma/Kaçın (satır satır)</label>
                <textarea id="do_not_list" rows="4" placeholder="Örn: Gizli bilgileri ifşa etme&#10;Varsayım üretme"></textarea>
              </div>
            </div>
          </details>

          <details class="block">
            <summary>Kaynakça ve Araçlar</summary>
            <div class="two-col">
              <label class="switch">
                <input id="references_required" type="checkbox" />
                <span>Kaynak/bağlantı isteniyor</span>
              </label>
              <div class="field">
                <label for="references_style">Kaynak stili</label>
                <input id="references_style" type="text" placeholder="Bağlantı (URL) ver, kaynağın güvenilirliğini belirt" />
              </div>
            </div>
            <div class="field">
              <label>Araçlar/Kabiliyetler</label>
              <div class="chips">
                <label><input type="checkbox" name="tools" value="Tarayıcı/Browse"><span>Tarayıcı/Browse</span></label>
                <label><input type="checkbox" name="tools" value="Kod çalıştırma"><span>Kod çalıştırma</span></label>
                <label><input type="checkbox" name="tools" value="Tablo/CSV okuma"><span>Tablo/CSV okuma</span></label>
                <label><input type="checkbox" name="tools" value="Veri analizi"><span>Veri analizi</span></label>
              </div>
            </div>
          </details>

          <details class="block">
            <summary>Format talimatı, Kabul kriteri, Kalite kontrol</summary>
            <div class="field">
              <label for="explicit_format_instructions">Çıktı biçim talimatları (özellikle JSON için)</label>
              <textarea id="explicit_format_instructions" rows="3" placeholder='Örn: Yanıtı geçerli JSON ver. Alanlar: ["title","steps","notes"].'></textarea>
            </div>
            <div class="two-col">
              <div class="field">
                <label for="acceptance_criteria">Kabul kriterleri (satır satır)</label>
                <textarea id="acceptance_criteria" rows="4"></textarea>
              </div>
              <div class="field">
                <label for="quality_checklist">Kalite kontrol maddeleri (satır satır; boşsa varsayılan)</label>
                <textarea id="quality_checklist" rows="4"></textarea>
              </div>
            </div>
            <div class="field">
              <label for="additional_instructions">Ek talimatlar</label>
              <textarea id="additional_instructions" rows="3"></textarea>
            </div>
          </details>

          <details class="block">
            <summary>Few-shot örnekler</summary>
            <div id="examples"></div>
            <button type="button" class="btn small" id="add-example">+ Örnek ekle</button>
          </details>

          <div class="field">
            <label for="target_platform">Hedef platform/çıktı türü (önizleme için hepsi üretilecek)</label>
            <select id="target_platform">
              <option>Genel</option>
              <option>OpenAI (system+user)</option>
              <option>Claude/Anthropic (tek prompt)</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button type="button" class="btn" id="generate">Önizlemeyi Güncelle</button>
          <button type="button" class="btn ghost" id="reset">Temizle</button>
          <span class="muted" id="status"></span>
        </div>
      </form>
    </section>

    <section class="card output-card">
      <h2>Çıktılar</h2>

      <div class="output-block">
        <div class="output-header">
          <h3>Tek Blok Prompt</h3>
          <div class="output-actions">
            <button class="btn small" data-copy="#single-block-output">Kopyala</button>
            <button class="btn small ghost" data-download="#single-block-output" data-ext="md">.md indir</button>
          </div>
        </div>
        <pre class="code"><code id="single-block-output"></code></pre>
      </div>

      <div class="output-block">
        <div class="output-header">
          <h3>OpenAI messages (JSON)</h3>
          <div class="output-actions">
            <button class="btn small" data-copy="#openai-json-output">Kopyala</button>
            <button class="btn small ghost" data-download="#openai-json-output" data-ext="json">.json indir</button>
          </div>
        </div>
        <pre class="code"><code id="openai-json-output"></code></pre>
      </div>

      <div class="output-block">
        <div class="output-header">
          <h3>Claude tek prompt</h3>
          <div class="output-actions">
            <button class="btn small" data-copy="#claude-output">Kopyala</button>
            <button class="btn small ghost" data-download="#claude-output" data-ext="txt">.txt indir</button>
          </div>
        </div>
        <pre class="code"><code id="claude-output"></code></pre>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <span>© Eggapps 2025 • <span id="version">v1.0</span></span>
  </footer>

  <!-- JS (inline) -->
  <script>
    const TONES=["Samimi ama profesyonel","Resmi","Nötr","Öğretici","Cesaretlendirici","Mizahi (dozunda)","Kısa ve net","Akademik","Hikâye anlatımı odaklı"];
    const STYLES=["Adım adım","Madde işaretli","Özet + detay","Kod ağırlıklı","Tablo kullan","Soru-cevap","Örnek odaklı"];
    const q=(s)=>document.querySelector(s);
    function val(id){ return document.getElementById(id).value.trim(); }
    function checked(name){ return Array.from(document.querySelectorAll('input[name="'+name+'"]:checked')).map(x=>x.value); }
    function linesToList(t){ return t.split("\\n").map(s=>s.trim()).filter(Boolean); }
    function defaultQC(){ return ["Yanıt hedef kitleye uygun mu?","Talep edilen biçim ve uzunlukta mı?","Varsayımlar belirtilmiş ve belirsizlikler sorulmuş mu?","Somut, uygulanabilir çıktı içeriyor mu?"]; }

    function toSingleBlock(r){
      const parts=[];
      if(r.title) parts.push("# "+r.title);
      parts.push("ROL/PERSONA:\\n"+r.role_persona);
      parts.push("AMAÇ:\\n"+r.objective);
      parts.push("HEDEF KİTLE ve DİL:\\n- Hedef kitle: "+r.audience+"\\n- Yanıt dili: "+r.language);
      const styleStr=r.style.length?r.style.join(", "):"Uygun gördüğün biçim";
      parts.push("TON ve ÜSLUP:\\n- Ton: "+r.tone+"\\n- Yazım/biçim: "+styleStr+"\\n- Tercih edilen çıktı formatı: "+r.output_format+"\\n- Yaklaşık uzunluk tercihi: "+r.length_pref);
      if(r.tools.length) parts.push("ARAÇLAR/KABİLİYETLER:\\n"+r.tools.join(", "));
      if(r.context) parts.push("BAĞLAM/BİLGİ:\\n"+r.context);
      if(r.input_data) parts.push("GİRDİ/VERİ:\\n"+r.input_data);
      const proc=[];
      if(r.ask_clar) proc.push("Eğer görev/bağlam belirsizse önce en fazla 3 netleştirici soru sor.");
      if(r.include_reasoning) proc.push("Problemi çözmeden önce kısa bir plan yap ve çözümde adım adım ilerle.");
      else proc.push("Gerekmedikçe içsel akıl yürütmeyi gösterme; nihai sonucu açık ve somut ver.");
      proc.push("Yanıtta gereksiz tekrar ve dolgu yapma; öz ve eyleme dönük ol.");
      parts.push("SÜREÇ/ÇALIŞMA BİÇİMİ:\\n- "+proc.join("\\n- "));
      if(r.references_required) parts.push("KAYNAK/KAYNAKÇA:\\n"+(r.references_style||"Bağlantı (URL) ver, kaynağın güvenilirliğini belirt"));
      if(r.constraints.length) parts.push("KISITLAR/KURALLAR:\\n- "+r.constraints.join("\\n- "));
      if(r.do_not_list.length) parts.push("YAPMA/KAÇIN:\\n- "+r.do_not_list.join("\\n- "));
      if(r.explicit_format_instructions) parts.push("ÇIKTI BİÇİM TALİMATLARI:\\n"+r.explicit_format_instructions);
      if(r.examples.length){
        const ex=r.examples.map((e,i)=>"ÖRNEK "+(i+1)+" - GİRİŞ:\\n"+e.input_text+"\\nÖRNEK "+(i+1)+" - ÇIKIŞ:\\n"+e.output_text);
        parts.push("FEW-SHOT ÖRNEKLER:\\n"+ex.join("\\n\\n"));
      }
      const qc=r.quality_checklist.length?r.quality_checklist:defaultQC();
      parts.push("KABUL KRİTERLERİ (yanıtın sağlaması gerekenler):\\n- "+(r.acceptance_criteria.length?r.acceptance_criteria.join("\\n- "):"—"));
      parts.push("KALİTE KONTROL — Göndermeden önce kontrol et:\\n- "+qc.join("\\n- "));
      if(r.additional_instructions) parts.push("EK TALİMATLAR:\\n"+r.additional_instructions);
      return parts.join("\\n\\n");
    }

    function toOpenAIMessages(r){
      const systemLines=[];
      systemLines.push("Rol/Persona: "+r.role_persona);
      systemLines.push("Hedef kitle: "+r.audience);
      systemLines.push("Dil: "+r.language);
      systemLines.push("Ton: "+r.tone);
      const styleStr=r.style.length?r.style.join(", "):"Uygun gördüğün biçim";
      systemLines.push("Üslup: "+styleStr);
      if(r.tools.length) systemLines.push("Araçlar/kabiliyetler: "+r.tools.join(", "));
      if(r.constraints.length) systemLines.push("Kurallar:\\n- "+r.constraints.join("\\n- "));
      if(r.do_not_list.length) systemLines.push("Kaçın:\\n- "+r.do_not_list.join("\\n- "));
      if(r.references_required) systemLines.push("Kaynakça politikası: "+(r.references_style||"Bağlantı (URL) ver, kaynağın güvenilirliğini belirt"));
      if(r.additional_instructions) systemLines.push("Ek talimatlar: "+r.additional_instructions);

      const userLines=[];
      userLines.push("Amaç/Görev: "+r.objective);
      if(r.context) userLines.push("Bağlam:\\n"+r.context);
      if(r.input_data) userLines.push("Girdi/Veri:\\n"+r.input_data);
      if(r.ask_clar) userLines.push("Belirsizse önce en fazla 3 netleştirici soru sor.");
      if(r.include_reasoning) userLines.push("Planını kısaca yap ve adım adım ilerle.");
      else userLines.push("Gerekmedikçe içsel akıl yürütmeyi gösterme; net sonuca odaklan.");
      userLines.push("Çıktı formatı: "+r.output_format+". Uzunluk: "+r.length_pref+".");
      if(r.explicit_format_instructions) userLines.push("Çıktı biçim talimatları:\\n"+r.explicit_format_instructions);
      if(r.acceptance_criteria.length) userLines.push("Kabul kriterleri:\\n- "+r.acceptance_criteria.join("\\n- "));
      if(r.examples.length){
        const ex=r.examples.map((e,i)=>"[Örnek "+(i+1)+" — Girdi]\\n"+e.input_text+"\\n[Örnek "+(i+1)+" — Çıktı]\\n"+e.output_text);
        userLines.push("Örnekler:\\n"+ex.join("\\n\\n"));
      }
      return [{role:"system",content:systemLines.join("\\n")},{role:"user",content:userLines.join("\\n\\n")}];
    }

    function toClaudePrompt(r){
      const styleStr=r.style.length?r.style.join(", "):"Uygun gördüğün biçim";
      let header=`You are: ${r.role_persona}\nAudience: ${r.audience}\nLanguage: ${r.language}\nTone: ${r.tone}\nStyle: ${styleStr}\n`;
      let rules="";
      if(r.constraints.length) rules+="Rules:\n- "+r.constraints.join("\n- ")+"\\n";
      if(r.do_not_list.length) rules+="Avoid:\n- "+r.do_not_list.join("\n- ")+"\\n";
      if(r.references_required) rules+=`References: ${r.references_style||"Provide URLs and mention source credibility"}\\n`;
      const proc=[];
      if(r.ask_clar) proc.push("If unclear, ask up to 3 clarifying questions first.");
      if(r.include_reasoning) proc.push("Plan briefly and proceed step-by-step.");
      else proc.push("Do not expose chain-of-thought; provide final answers.");
      proc.push("Output format: "+r.output_format+", Length: "+r.length_pref+".");
      if(r.explicit_format_instructions) proc.push("Formatting Instructions:\\n"+r.explicit_format_instructions);

      let body=`Objective:\\n${r.objective}\\n\\n`;
      if(r.context) body+=`Context:\\n${r.context}\\n\\n`;
      if(r.input_data) body+=`Input Data:\\n${r.input_data}\\n\\n`;
      if(r.examples.length){
        const ex=r.examples.map((e,i)=>`Example ${i+1} — Input:\\n${e.input_text}\\nExample ${i+1} — Output:\\n${e.output_text}`);
        body+="Few-shot Examples:\\n"+ex.join("\\n\\n")+"\\n\\n";
      }
      const qc=r.quality_checklist?.length?r.quality_checklist:["Meets format and length","Suited to audience","Concrete and actionable"];
      body+="Quality Checklist (self-check before finalizing):\\n- "+qc.join("\\n- ")+"\\n";
      return header+rules+proc.join("\\n")+"\\n\\n"+body;
    }

    function collectRecipe(){
      return {
        title: val("title"),
        role_persona: val("role_persona"),
        objective: val("objective"),
        audience: val("audience"),
        language: val("language") || "Türkçe",
        tone: document.getElementById("tone").value,
        style: checked("style"),
        output_format: document.getElementById("output_format").value,
        length_pref: document.getElementById("length_pref").value,
        ask_clar: document.getElementById("ask_clar").checked,
        include_reasoning: document.getElementById("include_reasoning").checked,
        constraints: (val("constraints")?val("constraints").split("\\n").map(s=>s.trim()).filter(Boolean):[]),
        do_not_list: (val("do_not_list")?val("do_not_list").split("\\n").map(s=>s.trim()).filter(Boolean):[]),
        references_required: document.getElementById("references_required").checked,
        references_style: val("references_style"),
        tools: checked("tools"),
        context: val("context"),
        input_data: val("input_data"),
        explicit_format_instructions: val("explicit_format_instructions"),
        acceptance_criteria: (val("acceptance_criteria")?val("acceptance_criteria").split("\\n").map(s=>s.trim()).filter(Boolean):[]),
        quality_checklist: (val("quality_checklist")?val("quality_checklist").split("\\n").map(s=>s.trim()).filter(Boolean):[]),
        examples: Array.from(document.querySelectorAll(".example")).map(box=>({
          input_text: box.querySelector(".example-input").value.trim(),
          output_text: box.querySelector(".example-output").value.trim()
        })).filter(e=>e.input_text || e.output_text),
        additional_instructions: val("additional_instructions"),
        target_platform: document.getElementById("target_platform").value
      };
    }

    function setCode(sel,text){ const el=q(sel); if(el) el.textContent=text; }
    function setStatus(msg){ const s=document.getElementById("status"); s.textContent=msg; if(!msg) return; setTimeout(()=>{s.textContent=""},2000); }

    function render(){
      const r=collectRecipe();
      setCode("#single-block-output", toSingleBlock(r));
      setCode("#openai-json-output", JSON.stringify(toOpenAIMessages(r), null, 2));
      setCode("#claude-output", toClaudePrompt(r));
      localStorage.setItem("promptWizardState", JSON.stringify(r));
      setStatus("Önizleme güncellendi ✔");
    }

    function addExample(input="", output=""){
      const wrap=document.createElement("div");
      wrap.className="example example-block";
      wrap.innerHTML=`
        <div class="row">
          <div class="field">
            <label>Örnek GİRİŞ</label>
            <textarea class="example-input" rows="3" placeholder="Örnek girdi..."></textarea>
          </div>
          <div class="field">
            <label>Örnek ÇIKIŞ</label>
            <textarea class="example-output" rows="3" placeholder="Örnek çıktı..."></textarea>
          </div>
        </div>
        <div style="display:flex;justify-content:flex-end;margin-top:6px">
          <button type="button" class="remove-example">Sil</button>
        </div>`;
      wrap.querySelector(".example-input").value=input;
      wrap.querySelector(".example-output").value=output;
      wrap.querySelector(".remove-example").addEventListener("click", ()=>{ wrap.remove(); render(); });
      document.getElementById("examples").appendChild(wrap);
    }

    function copyFrom(selector){
      const text=document.querySelector(selector).textContent;
      navigator.clipboard.writeText(text).then(()=> setStatus("Kopyalandı ✔"));
    }
    function downloadFrom(selector, ext){
      const text=document.querySelector(selector).textContent;
      const nameBase=(document.getElementById("title").value || document.getElementById("objective").value || "prompt")
        .toLowerCase().replace(/[^a-z0-9ğüşöçıİĞÜŞÖÇ\\s-]/gi,"").replace(/\\s+/g,"-").slice(0,60) || "prompt";
      const ts=new Date().toISOString().replace(/[-:T]/g,"").slice(0,15);
      const fileName=\`\${nameBase}_\${ts}.\${ext}\`;
      const blob=new Blob([text],{type:"text/plain;charset=utf-8"});
      const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download=fileName;
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(a.href);
      setStatus(\`\${fileName} indirildi ✔\`);
    }
    function resetForm(){
      document.getElementById("wizard-form").reset();
      document.getElementById("examples").innerHTML="";
      localStorage.removeItem("promptWizardState");
      render();
    }

    // Events
    document.addEventListener("click",(e)=>{
      const btn=e.target.closest("[data-copy]");
      if(btn) copyFrom(btn.getAttribute("data-copy"));
      const dbtn=e.target.closest("[data-download]");
      if(dbtn) downloadFrom(dbtn.getAttribute("data-download"), dbtn.getAttribute("data-ext"));
    });
    document.getElementById("generate").addEventListener("click", render);
    document.getElementById("reset").addEventListener("click", resetForm);
    document.getElementById("add-example").addEventListener("click", ()=> addExample());

    // Auto-load state
    (function init(){
      try{
        const saved=localStorage.getItem("promptWizardState");
        if(saved){
          const r=JSON.parse(saved);
          const set=(id,v)=>{ const el=document.getElementById(id); if(el) el.value=v ?? ""; };
          set("title", r.title); set("role_persona", r.role_persona); set("objective", r.objective);
          set("audience", r.audience); set("language", r.language);
          document.getElementById("tone").value=r.tone || "Samimi ama profesyonel";
          (r.style||[]).forEach(s=>{
            const cbs=[...document.querySelectorAll('input[name="style"]')]; const cb=cbs.find(x=>x.value===s); if(cb) cb.checked=true;
          });
          document.getElementById("output_format").value=r.output_format || "Markdown";
          document.getElementById("length_pref").value=r.length_pref || "Orta";
          document.getElementById("ask_clar").checked=!!r.ask_clar;
          document.getElementById("include_reasoning").checked=!!r.include_reasoning;
          set("constraints", (r.constraints||[]).join("\\n"));
          set("do_not_list", (r.do_not_list||[]).join("\\n"));
          document.getElementById("references_required").checked=!!r.references_required;
          set("references_style", r.references_style);
          (r.tools||[]).forEach(t=>{
            const cbs=[...document.querySelectorAll('input[name="tools"]')]; const cb=cbs.find(x=>x.value===t); if(cb) cb.checked=true;
          });
          set("context", r.context); set("input_data", r.input_data);
          set("explicit_format_instructions", r.explicit_format_instructions);
          set("acceptance_criteria", (r.acceptance_criteria||[]).join("\\n"));
          set("quality_checklist", (r.quality_checklist||[]).join("\\n"));
          (r.examples||[]).forEach(e=> addExample(e.input_text, e.output_text));
          set("additional_instructions", r.additional_instructions);
          document.getElementById("target_platform").value=r.target_platform || "Genel";
        }
      }catch(e){ console.warn("State load failed", e); }
      render();
    })();
  </script>
</body>
</html>
